# 제약 조건 추가 및 실험험
weight:
하중 제약은 바닥의 각 위치가 허용 하중 값 \(W(x,y)\)를 가진다고 보고, 설비는 하중(요구) 값 \(w\)를 가진다고 보는 규칙이다. 배치 가능 조건은 설비 footprint가 덮는 모든 위치에 대해 \(w \le W(x,y)\)가 성립하는 것이다. 따라서 footprint 안에 단 한 칸이라도 \(W(x,y) < w\)인 셀이 포함되면 즉시 배치 불가가 된다. 이 때문에 무거운 설비는 허용 하중이 높은 구역만 밟을 수 있고, 경계에 조금이라도 걸치면 실패한다(부분 겹침 허용 없음).

height:
높이 제약은 바닥의 각 위치가 천장 높이 값 \(H(x,y)\)를 가진다고 보고, 설비는 높이 \(h\)를 가진다고 보는 규칙이다. 배치 가능 조건은 설비 footprint가 덮는 모든 위치에 대해 \(h \le H(x,y)\)가 성립하는 것이다. 즉 footprint 안에 단 한 칸이라도 \(H(x,y) < h\)인 셀이 포함되면 배치 불가가 된다. 결과적으로 높은 설비는 낮은 천장 구역을 한 칸도 밟을 수 없고, 낮은 천장 존은 높은 설비에게 사실상 금지영역처럼 동작한다.

dry:
dry 제약은 바닥의 각 위치가 요구 dry 수준 \(R(x,y)\)를 가진다고 보고, 설비는 “만족 가능한 dry 수준” \(d\)를 가진다고 보는 규칙이다. 배치 가능 조건은 설비 footprint가 덮는 모든 위치에 대해 \(d \ge R(x,y)\)가 성립하는 것이다. 따라서 footprint 안에 단 한 칸이라도 \(R(x,y) > d\)인 셀이 포함되면 즉시 배치 불가가 된다. 

clearance:
clearance는 설비 간 안전거리로 해석하며 “body(실제 설비 면적)”와 “pad(body + 자기 clearance)”를 구분해서 적용한다. 배치 가능 조건은 (1) 새 설비의 body가 기존 금지영역(정적 금지/이미 점유/존 제약)과 겹치면 실패, (2) 새 설비의 body가 이미 배치된 다른 설비들의 clearance 영역과 겹치면 실패, (3) 새 설비의 pad가 기존 금지영역과 겹치면 실패로 정리된다. 다만 설비들 사이의 clearance 영역끼리 서로 겹치는 것은 허용하여, 안전거리 규칙이 배치를 과도하게 막는 상황을 줄인다.

![zone_maps](./zone_maps.png) 

이러한 제약을 도입하면 설비마다 실제로 배치 가능한 영역의 크기가 크게 달라진다. 그래서 초기 배치 순서는 단순히 “면적 큰 설비 우선”이 아니라, (정적 금지 + 해당 설비가 위반하는 존)으로 인해 남는 유효 공간 대비 설비 footprint가 클수록 먼저 배치하는 난이도 기준을 사용해 실패 가능성을 줄인다. 큰 설비를 뒤로 미루면 나중에 들어갈 자리가 사라지는 경우가 많기 때문에, 큰 설비를 앞쪽으로 당기는 효과가 있다. (추후에는 footprint 크기별로 “실제로 들어갈 수 있는 위치 수”를 빠르게 추정해서 더 정확한 난이도 정렬로 고도화할 수 있다.)

또한 제약/clearance를 추가하면 “배치 가능 판정”이 더 자주/더 비싸게 호출되므로, 불필요한 큰 맵 합성이나 재할당이 누적되면 시뮬레이션 비용이 크게 증가한다. 그래서 배치 가능 판정에서는 조건을 한 번에 합쳐 큰 맵을 매번 만드는 방식을 피하고, 필요한 충돌 조건을 분리해 확인하며, 전체 금지맵 갱신도 매번 새 텐서를 만들지 않고 기존 버퍼를 갱신하는 방식으로 메모리/연산 낭비를 줄였다. 이 최적화는 MCTS처럼 환경을 반복 호출하는 상황에서 특히 중요하다.

# 제약약 실험

